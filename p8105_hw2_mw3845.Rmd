---
title: "p8105_hw2_mw3845"
author: "Minghe Wang"
date: "2024-09-29"
output: github_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(tidyverse)
library(dplyr)
library(readxl)
```

## Problem 1

###### read and clean the data

```{r problem1_read_and_clean_data}
#read and clean the data
subway_df = 
  read_csv('./data/NYC_Transit_Subway_Entrance_And_Exit_Data.csv', na = "",
    col_types = cols(
    Route8 = col_character(),
    Route9 = col_character(),
    Route10 = col_character(),
    Route11 = col_character())
    ) |>
  janitor::clean_names() |>
  select(line:entry, vending, ada) |>
  mutate(
    entry = ifelse(entry=='YES', TRUE, FALSE)
  )
```

So far, we read and clean the data of NYC's subway. The data contains ` line`, `station_name`, `station_latitude`, `station longitude`, `route1` to `route11`, `entry`, `vending`, `entrance_type`, and `ada`. 

- Cleaning steps: the variables' names are converting into lower snake case; the 19 variables mentioned above are selected; and `entry` is converted into logical variable (`YES` to `TRUE`, `NO` to `FALSE`).
- Dimension: the dimension of resulting dataset is `r nrow(subway_df)` x `r ncol(subway_df)`.

###### Analyze dataset with unique stations:

```{r unique station dataframe}
uni_station_df = distinct(subway_df, line, station_name, .keep_all=TRUE) |>
  mutate(
    vending = ifelse(vending=='YES', TRUE, FALSE)
  )
```
- How many distinct stations are there?
  
  _There are `r nrow(uni_station_df)` stations in the dataset._

- How many stations are ADA compliant?

  _There are `r sum(pull(uni_station_df, ada))` stations are ADA compliant._
  
- What proportion of station entrances / exits without vending allow entrance?

  _37.7% of station entrances / exits without vending allow entrance.  Note: Here we are not using the unique station data   because a station might have multiple entrances / exits that the entry w/o vending could happen._

```{r entry w/o vending}
subway_df |>
  filter(vending == 'NO') |>
  pull(entry) |>
  mean()
```

  
###### Reformatting the data to analyze the stations that serves A train:
  
```{r reformatting uni_station_df}
# pivot dataframe longer to count A train
longer_uni_station_df = pivot_longer(
  uni_station_df,
  route1:route11,
  names_to = 'route',
  values_to = 'train'
)
# filter the longer dataframe to count ADA compliant A train
a_train_df = longer_uni_station_df |>
  filter(train == 'A')
```

There are `r sum(pull(longer_uni_station_df, train) == 'A', na.rm = TRUE)` distinct stations serve A train. And `r sum(pull(a_train_df, ada))` of the stations that serve A train are ADA compliant.

# Problem 2

Here we read the data from `Mr Trash Wheel` sheet in the excel file. For data cleaning: the variable names are cleaned; non-data entry `...15` and `...16` are omitted; the empty rows are omitted; and the `sports_ball` is rounded and converted into the integer variable. Then we add a variable `source` to this dataset so that we can better identify the data from it after combining this dataset with other two in the later part. **However, `homes_powered` contains 0s and NAs which instead could be computed by `weight_tons`, whether should we correct it?**
```{r p2_read_and_clean_MrTW}
mr_trash_df = 
  read_excel('./data/202409 Trash Wheel Collection Data.xlsx', 
             sheet = 'Mr. Trash Wheel') |>
  janitor::clean_names() |>
  select(-x15, -x16) |>
  filter(!if_all(everything(), is.na)) |>
  mutate(sports_balls = as.integer(round(sports_balls)),
         source = 'mr_trash_wheel',
         year = as.double(year))

tail(mr_trash_df)
```

Similarly, we read and clean the datasets of `Professor Trash Wheel` and `Gwynnda Trash Wheel` sheets in the excel. These two datasets are slightly different from `Mr Trash Wheel` that they does not contain non-data entry nor the `sports_balls` variable.

```{r p2_read_and_clean_other_2_dataset}
prof_trash_df = 
  read_excel('./data/202409 Trash Wheel Collection Data.xlsx', sheet = 'Professor Trash Wheel') |>
  janitor::clean_names() |>
  filter(!if_all(everything(), is.na)) |>
  mutate(source = 'professor_trash_wheel')
  
gwy_trash_df = 
  read_excel('./data/202409 Trash Wheel Collection Data.xlsx', sheet = 'Gwynnda Trash Wheel') |>
  janitor::clean_names() |>
  filter(!if_all(everything(), is.na)) |>
  mutate(source = 'gwynnda_trash_wheel')

head(mr_trash_df)
```

```{r combine 3 datasets}
combined_df = bind_rows(mr_trash_df, prof_trash_df, gwy_trash_df)

# Check the structure
str(combined_df)

# Summary statistics
summary(combined_df)

# View the first few rows
combined_df

```